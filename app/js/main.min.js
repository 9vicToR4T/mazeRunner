let brick=new Image;brick.src="../img/brick.jpg";let flag=new Image;flag.src="../img/flag.jpg";let pavement=new Image;pavement.src="../img/pavement.webp";let user=new Image;user.src="../img/user.png";let winBlock=document.querySelector(".win");winBlock.addEventListener("click",(function(){console.log("remove"),winBlock.classList.add("active")}));let map=[[0,0,1,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,1,0,1,1,0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,1,1,0,0,0,0],[0,1,1,0,0,1,0,1,0,1,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],[0,0,1,0,1,1,0,0,0,0,0,0,0,0,0],[2,0,1,0,0,1,0,0,0,1,0,0,0,0,0]],mooves=0;const score=document.querySelector(".score"),hit=document.querySelector(".hit");function updateScore(e){return score.innerText=`Score: ${e}`}let c=document.getElementById("canvas"),ctx=c.getContext("2d"),player={x:0,y:0,newX:0,newY:0},collBox=[],tailSize=50,mapHeight=map.length,mapWidth=map[0].length;function drawMap(e){for(let a=0;a<e.length;a++){collBox.push([]);for(let l=0;l<e[a].length;l++)1===e[a][l]?(ctx.beginPath(),ctx.drawImage(brick,l*tailSize,a*tailSize,tailSize,tailSize)):2===e[a][l]?(ctx.beginPath(),ctx.drawImage(flag,l*tailSize,a*tailSize,tailSize,tailSize)):(ctx.beginPath(),ctx.drawImage(pavement,l*tailSize,a*tailSize,tailSize,tailSize)),collBox[a].push({x:l*tailSize,y:a*tailSize,status:1===e[a][l]?1:2===e[a][l]?2:0})}}function drawPlayer(e,a){ctx.beginPath(),ctx.drawImage(user,e,a,tailSize,tailSize)}function deleteMapAndPlayer(){ctx.clearRect(0,0,mapWidth*tailSize,mapHeight*tailSize),ctx.clearRect(player.newX,player.newY,player.newX+tailSize,player.newY+tailSize),player={x:0,y:0,newX:0,newY:0},console.log("deleted")}function move(e,a){ctx.clearRect(0,0,mapWidth*tailSize,mapHeight*tailSize),drawMap(map),drawPlayer(e,a),player.x=player.newX,player.y=player.newY}function showAlert(){hit.classList.add("show"),setTimeout((()=>{hit.classList.remove("show")}),2e3)}function checkMoove(){console.log(player);for(let e=0;e<mapHeight;e++)for(let a=0;a<mapWidth;a++){let l=collBox[e][a];player.newX===l.x&&player.newY===l.y?1===l.status?(showAlert(),console.log("Hit the rock")):2===l.status?(console.log("WIN"),move(player.newX,player.newY),winBlock.classList.remove("active"),mooves=0,updateScore(mooves),deleteMapAndPlayer(),drawMap(map),drawPlayer(0,0)):move(player.newX,player.newY):(player.newX<0||player.newY<0||player.newX>=mapWidth*tailSize||player.newY>=mapHeight*tailSize)&&console.log("OUT of the wall")}}window.onkeydown=function(e){mooves++,updateScore(mooves),37===e.keyCode&&(player.newX=player.x-tailSize,player.newY=player.y),38===e.keyCode&&(player.newY=player.y-tailSize,player.newX=player.x),39===e.keyCode&&(player.newX=player.x+tailSize,player.newY=player.y),40===e.keyCode&&(player.newY=player.y+tailSize,player.newX=player.x),checkMoove()},window.onload=function(){drawMap(map),drawPlayer(0,0)};